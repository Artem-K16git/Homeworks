# Резервное копирование - Капитонов Артем Александрович





---

### Задание 1.  Резервное копирование
Кейс  
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.  
Необходимо описать, какие варианты резервного копирования подходят в случаях:  
1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.  
1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.  
1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.
Приведите ответ в свободной форме.  
#### Ответ: 
1.1. Так как приоритет отдается надежности, то полный бэкап 1 раз в сутки(ночью, в моменты минимальных нагрузок на базу и сеть).  
1.2. Из-за приоритета надежности, 1 полный бэкап в сутки и 1 дифференциальный бэкап в час.  
1.3.* Возможен. Для этих целей нужно использовать репликацию. Slave-сервер может автоматом перехватывать роль мастер-сервера  при его недоступности.
Остается только настроить автоматическое перенаправление и возврат к предыдущей конфигурации(при восстановлении старого мастер-сервера).

 

---

### Задание 2. PostgreSQL
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).  
2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?  
Приведите ответ в свободной форме. 
#### Ответ:  

2.1. 
Выгрузка:
```
pg_dump -U user -h localhost -p 5432 -d sakila -Fc -f /path/to/backup/sakiladb.backup
```
где:
- U - имя пользователя;  
- h - адрес сервера, где работает БД;
- p - номер порта,через которые принимаются подключения;
- d - имя БД;
- Fc - формат дампа;
- f - имя файла, с указанием пути к нему, в который будет сохранен резерв.копия.
Восстановление:
```
pg_restore -U user -h localhost -p 5432 -d sakila -v /path/to/backup/sakiladb.backup
```
где:  
- Uhpd - указывал в предыдущем примере;  
- v - включает режим подробного логгирования.

2.1.*
Можно автоматизировать. Написать скрипт и добавить в cron  его запуск в 4-5 утра.  
Пример:  
https://github.com/Artem-K16git/Homeworks/blob/main/SQL/Backup/pg_backup.bash  
Скрипт не мой.
Взял [отсюда](https://habr.com/ru/articles/595641/)


---


### Задание 3. MySQL
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.  
3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?  
Приведите ответ в свободной форме.  
 #### Ответ:  




